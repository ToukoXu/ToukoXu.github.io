<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>闭包（Closure）：JavaScript 里的 “记忆小助手” | Touko</title><meta name="keywords" content="JavaScript,ES6"><meta name="author" content="Touko"><meta name="copyright" content="Touko"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="闭包（Closure）：JavaScript 里的 “记忆小助手”"><meta name="application-name" content="闭包（Closure）：JavaScript 里的 “记忆小助手”"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="闭包（Closure）：JavaScript 里的 “记忆小助手”"><meta property="og:url" content="http://toukoxu.github.io/archives/closure/index.html"><meta property="og:site_name" content="Touko"><meta property="og:description" content="闭包是 JavaScript 中比较容易让人困惑的概念 —— 它能让函数 “记住自己成长的环境”，哪怕后来跑到别的地方工作，也能找回当初的变量。今天就抛开复杂术语，用更通俗的方式拆解闭包，从原理到实战一次讲明白！  前置知识如果对作用域链还不熟悉，建议先看下面这篇。理解函数如何查找变量后，再理解闭"><meta property="og:locale" content="zh"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/closure.webp"><meta property="article:author" content="Touko"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/closure.webp"><meta name="description" content="闭包是 JavaScript 中比较容易让人困惑的概念 —— 它能让函数 “记住自己成长的环境”，哪怕后来跑到别的地方工作，也能找回当初的变量。今天就抛开复杂术语，用更通俗的方式拆解闭包，从原理到实战一次讲明白！  前置知识如果对作用域链还不熟悉，建议先看下面这篇。理解函数如何查找变量后，再理解闭"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://toukoxu.github.io/archives/closure/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3NsfNkdtkVbxAr4D","LingQueMonitorID":"3NsfQzcXKkH79lbY"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 科技爱好者","🔨 开发一条龙","🌌 Hello World 宇宙","⌨️ 键盘撸猫区","🐱 万物皆可rua"]},
  algolia: {"appId":"PYE1KWH569","apiKey":"cf60fd4b204d6ed4fc261c973f2a5489","indexName":"blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"本文最后一次更新为","messageNext":"天前，文章中的某些内容可能已过时！"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: Touko","link":"链接: ","source":"来源: Touko","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"},"ignore":["/projects/image-base64","/projects/text-diff"]},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Touko',
  title: '闭包（Closure）：JavaScript 里的 “记忆小助手”',
  postAI: '',
  pageFillDescription: '前置知识, 一、闭包的本质：函数 + 诞生环境, 1.1 到底什么是闭包（Closure）？, 1.2 闭包形成的三个关键条件, 1.3 闭包的核心特点, 二、拆解闭包：看看它 记着 哪些东西, 2.1 经典案例：带闭包的计数器, 2.2 闭包的作用域链, 三、闭包的实战场景, 3.1 数据封装：实现 私有变量, 3.2 函数工厂：批量生成 定制化函数, 3.3 事件处理：保留 上下文信息, 3.4 模块模式：早期前端模块化的基础, 四、闭包的坑：内存浪费与优化, 4.1 为什么会内存浪费？, 4.2 优化技巧：避免内存浪费, 4.3 闭包 vs ES6 块级作用域, 五、底层原理：闭包为什么能 记住 环境？, 5.1 现代引擎的优化：不用怕闭包影响性能, 六、闭包最佳实践：这些坑我踩过你别踩, 七、常见问题解答, Q1：闭包是什么？举个例子, Q2：闭包有什么优缺点？, Q3：如何避免闭包导致的内存浪费？, 八、闭包总结：不是难题是实用工具闭包是中比较容易让人困惑的概念它能让函数记住自己成长的环境哪怕后来跑到别的地方工作也能找回当初的变量今天就抛开复杂术语用更通俗的方式拆解闭包从原理到实战一次讲明白前置知识如果对作用域链还不熟悉建议先看下面这篇理解函数如何查找变量后再理解闭包会更顺畅站内地址作用域链一闭包的本质函数诞生环境到底什么是闭包官方定义有点抽象闭包是函数与其声明时所在词法环境的组合换成人话就是一个函数在老家声明时的作用域定义时记下了周围的变量后来就算跑到外地其他作用域执行也能找到这些老家的变量这就形成了闭包举个直观的例子你看这个带记忆的函数这个变量是老家的东西属于外部函数作用域我是函数在老家时记住的内容内部函数相当于能找回老家东西的钥匙访问老家的变量取出这个带记忆的函数此时外部函数已执行完正常来说内部变量该消失了调用函数居然还能找到输出我是函数在老家时记住的内容这里的就是闭包它记得自己老家的环境所以就算执行完了也能找回闭包形成的三个关键条件不是所有函数都是闭包得满足这三个条件函数嵌套内部函数定义在外部函数里面比如在里记着老家的变量内部函数用到了外部函数的变量或参数用了离开老家内部函数被返回传递到外部函数作用域之外被出去赋值给这里有个容易误解的点闭包不是我们刻意创建的而是函数定义时的自然结果只要满足上面三个条件闭包就会自动形成不用写特殊语法它就在那了闭包的核心特点变量持久化相当于给变量延长了生命周期正常情况下函数执行完内部变量会被垃圾回收机制清理但闭包能让变量一直活着比如上面的变量私有权外部无法直接碰闭包记住的变量比如你没法直接改只能通过这个接口访问这就实现了数据私有作用域链保留闭包不只是记着自己用的变量而是记着整个老家的环境链外部函数作用域全局作用域比如如果还引用了全局变量闭包也能找到二拆解闭包看看它记着哪些东西经典案例带闭包的计数器用闭包实现计数器是最常见的场景能清晰看到闭包如何保管变量被闭包保管的变量外部拿不到返回三个操作接口都是闭包加减查当前值创建一个计数器输出试着直接访问拿不到无法直接访问这里的都是闭包它们共享同一个变量不管调用哪个方法操作的都是同一个计数器就像几个人共用一个笔记本一样闭包的作用域链闭包能找到变量靠的是作用域链拿上面的计数器举例作用域链是这样的内部函数的环境外部函数的环境全局环境当执行时会先在自己的环境找没找到再顺着作用域链往上找直到在的环境里找到这就是闭包能访问外部变量的原理关键点闭包会保留整个作用域链而不仅仅是它用到的变量三闭包的实战场景闭包不是理论概念实际开发中到处都有它的影子分享几个我常用的场景数据封装实现私有变量没有原生的私有变量语法但用闭包就能模拟比如实现一个银行账户余额只能通过存款取款接口操作不能直接修改私有变量外部无法直接访问存款只能通过这个方法加余额取款带校验逻辑防止余额不足余额不足查询余额只能看不能改余额创建账户初始元存余额试着取会报错因为有校验余额不足我在写组件状态管理时经常用这种方式封装敏感数据防止外部代码误改导致函数工厂批量生成定制化函数如果需要多个逻辑相似但参数不同的函数用闭包做函数工厂特别方便比如生成不同风格的问候语是定制参数被闭包记住生成正式问候和友好问候两个函数尊敬的嘿用的时候直接传名字就行不用再重复写前缀王总尊敬的王总小明嘿小明我之前做表单验证时用这个方法生成了一堆校验函数比如最小长度校验最大长度校验不用重复写逻辑代码简洁了很多事件处理保留上下文信息写事件绑定的时候经常需要在回调里用外部变量这时候闭包就派上用场了比如给多个按钮绑定点击事件输出各自的索引按钮被点击这里的箭头函数就是闭包它记住了循环时的不过如果用声明没有块级作用域反而会出问题得用闭包兼容不过现在有就简单多了模块模式早期前端模块化的基础在出现之前前端模块化基本靠闭包实现比如封装一个工具模块只暴露需要的接口内部逻辑隐藏起来私有状态外部看不到初始化私有函数只能在模块内部用执行内部操作公开接口外部只能通过这些方法访问内部已更新调用公开方法执行内部操作已更新试着访问私有成员拿不到这种模式我在维护老项目时经常见到虽然现在有了但闭包的封装思想依然很有用四闭包的坑内存浪费与优化闭包虽好用但用不好容易出问题最常见的就是内存浪费内存泄漏为什么会内存浪费闭包会留住它记住的环境里的变量不让垃圾回收机制清理如果闭包引用了大对象比如元素超大数组又一直没被销毁这些对象就会一直占着内存导致内存越用越多举个反面例子模拟一个的大数组占用内存的数据闭包引用了调用后被闭包记住无法被清理就算后面不用了也还在内存里如果这种闭包多了页面会越来越卡甚至崩溃内存泄漏警告闭包会阻止其作用域链上所有变量被回收不当使用会导致内存泄漏优化技巧避免内存浪费分享几个我实战中用过的优化方法主动忘记变量不用闭包时手动把它记住的变量设为让能清理需要保留的数据给闭包加个清理方法解除引用让闭包忘记能回收了使用完闭包后调用清理方法只记需要的内容如果只需要大对象的部分数据就别引用整个对象大数据只记需要的小数据比如长度不引用整个闭包块级作用域有些场景下的块级作用域能替代闭包代码更简洁比如之前的循环绑定事件旧方法用闭包兼容的问题新方法用的块级作用域不用闭包输出因为在循环里每次迭代都会创建一个新的作用域定时器回调能直接拿到当前的这时候就不用再写闭包了五底层原理闭包为什么能记住环境其实闭包的底层就是作用域链的机制再梳理下它的形成过程外部函数被调用创建执行环境内部函数定义记录当前的词法环境内部函数引用外部函数的变量外部函数执行完返回内部函数到外部作用域内部函数被调用时通过作用域链找到外部变量闭包生效简单说函数定义时会记下自己在哪出生词法作用域执行时会顺着这个出生地链条找变量闭包就是利用了这个机制让函数在别的地方执行时还能找到老家的环境现代引擎的优化不用怕闭包影响性能很多人担心闭包性能差但现代引擎比如和用的对闭包做了很多优化按需保留只保留闭包真正用到的变量没用的变量会被清理比如上面的如果没被引用就会被回收缓存常用变量频繁访问的闭包变量会被缓存访问速度更快优化对象查找对闭包引用的对象做特殊处理减少属性查找时间所以不用过度担心闭包的性能问题正常使用下性能开销可以忽略不计只有在循环里频繁创建闭包比如每秒创建上千个才需要注意优化六闭包最佳实践这些坑我踩过你别踩分享几个我实战中总结的经验帮你避开闭包的坑少记无关内容只让闭包记住必要的变量别把不需要的东西也带在身上比如上面的银行账户只暴露等方法不暴露能不用就不用如果用块级作用域能解决问题就别用闭包比如循环里用替代闭包代码更简洁也少了内存开销小心循环引用闭包引用元素时容易形成闭包闭包的循环引用解决方法是事件不用时手动移除监听或用弱引用存储明确生命周期用闭包封装组件时尽量做成自包含的模块不用时调用清理方法释放内存七常见问题解答闭包是什么举个例子闭包是函数记住并访问其词法作用域的能力哪怕函数在词法作用域之外执行比如实现计数器闭包有什么优缺点优点实现数据封装私有变量防止外部误改保留变量状态比如计数器不用依赖全局变量批量生成定制化函数函数工厂是早期前端模块化的基础缺点可能导致内存浪费引用的变量无法清理频繁创建闭包有轻微性能开销调试时不容易追踪变量来源里变量会标为如何避免闭包导致的内存浪费只让闭包记住必要的变量减少无关引用不用闭包时主动把引用的变量设为避免在闭包里引用大对象比如大数组整个树用存储引用让能清理明确闭包的生命周期不用时执行清理逻辑比如移除事件监听八闭包总结不是难题是实用工具最后用一张表总结闭包的核心特性方便大家回顾特性说明应用场景词法作用域闭包的基础函数定义时决定老家所有闭包场景保留变量状态让变量不被清理持续可用计数器缓存工具数据封装变量私有只能通过闭包访问模块开发模拟类函数工厂动态生成带定制参数的函数表单验证问候语生成内存开销保留作用域链可能占内存需要优化的场景调试标识中变量标为调试闭包相关问题很多人觉得闭包难是因为它看不见摸不着但其实只要理解函数记住老家环境这个核心再结合实际场景多练很快就能掌握闭包不是需要害怕的难题而是里实用的工具用好了它你就能写出更安全更优雅的代码比如封装组件管理状态实现模块化现在就试着用闭包写个小工具吧',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-03 20:46:25',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link href="https://fonts.cdnfonts.com/css/shina-baby" rel="stylesheet"><link rel="alternate" type="application/rss+xml" title="Touko" href="http://toukoxu.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Touko" href="http://toukoxu.github.io/atom.xml"><link rel="alternate" type="application/json" title="Touko" href="http://toukoxu.github.io/feed.json"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/site/loading.webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://toukoxu.github.io/" title="博客" target="_blank"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">图片工具</div><div class="back-menu-list"><a class="back-menu-item" href="/projects/image-base64" title="图片转Base64" target="_blank"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/picture.gif" alt="图片转Base64"/><span class="back-menu-item-text">图片转Base64</span></a><a class="back-menu-item" href="/projects/image-webp" title="图片转WebP" target="_blank"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/picture.gif" alt="图片转WebP"/><span class="back-menu-item-text">图片转WebP</span></a><a class="back-menu-item" href="/projects/image-compress" title="图片压缩" target="_blank"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/picture.gif" alt="图片压缩"/><span class="back-menu-item-text">图片压缩</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">文本工具</div><div class="back-menu-list"><a class="back-menu-item" href="/projects/text-diff" title="文本差异对比" target="_blank"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/text.gif" alt="文本差异对比"/><span class="back-menu-item-text">文本差异对比</span></a><a class="back-menu-item" href="/projects/image-base64" title="CSS/JS压缩" target="_blank"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/text.gif" alt="CSS/JS压缩"/><span class="back-menu-item-text">CSS/JS压缩</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">金融工具</div><div class="back-menu-list"><a class="back-menu-item" href="/projects/finance-calculator" title="金融计算器" target="_blank"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/star.gif" alt="金融计算器"/><span class="back-menu-item-text">金融计算器</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Touko</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/wechat.webp" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/wechat.webp"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/alipay.webp" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/alipay.webp"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">February 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/05/"><span class="card-archive-list-date">May 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">April 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/03/"><span class="card-archive-list-date">March 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/JavaScript/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>JavaScript</span></a><a class="article-meta__tags" href="/tags/ES6/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>ES6</span></a></span></div></div><h1 class="post-title" itemprop="name headline">闭包（Closure）：JavaScript 里的 “记忆小助手”</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-04-03T12:46:25.000Z" title="发表于 2021-04-03 20:46:25">2021-04-03</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2021-04-03T12:46:25.000Z" title="更新于 2021-04-03 20:46:25">2021-04-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">3.8k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="闭包（Closure）：JavaScript 里的 “记忆小助手”"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为上海"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>上海</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/closure.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://toukoxu.github.io/archives/closure/"><header><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a><a href="/tags/JavaScript/" tabindex="-1" itemprop="url">JavaScript</a><a href="/tags/ES6/" tabindex="-1" itemprop="url">ES6</a><h1 id="CrawlerTitle" itemprop="name headline">闭包（Closure）：JavaScript 里的 “记忆小助手”</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Touko</span><time itemprop="dateCreated datePublished" datetime="2021-04-03T12:46:25.000Z" title="发表于 2021-04-03 20:46:25">2021-04-03</time><time itemprop="dateCreated datePublished" datetime="2021-04-03T12:46:25.000Z" title="更新于 2021-04-03 20:46:25">2021-04-03</time></header><blockquote>
<p>闭包是 JavaScript 中比较容易让人困惑的概念 —— 它能让函数 “记住自己成长的环境”，哪怕后来跑到别的地方工作，也能找回当初的变量。今天就抛开复杂术语，用更通俗的方式拆解闭包，从原理到实战一次讲明白！</p>
</blockquote>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>如果对作用域链还不熟悉，建议先看下面这篇。理解函数如何查找变量后，再理解闭包会更顺畅～</p>
<div calss="anzhiyu-tag-link"><a class="tag-Link" target="_blank" href="/2021/03/16/scope-chain">
    <div class="tag-link-tips">站内地址</div>
    <div class="tag-link-bottom">
        <div class="tag-link-left" style="background-image: url(/img/512.png)">
          <i class="anzhiyufont anzhiyu-icon-link" style="display: none"></i>
        </div>
        <div class="tag-link-right">
            <div class="tag-link-title">作用域链（Scope Chain）</div>
            <div class="tag-link-sitename"> Touko</div>
        </div>
        <i class="anzhiyufont anzhiyu-icon-angle-right"></i>
    </div>
    </a></div>

<h2 id="一、闭包的本质：函数-诞生环境"><a href="#一、闭包的本质：函数-诞生环境" class="headerlink" title="一、闭包的本质：函数 + 诞生环境"></a>一、闭包的本质：函数 + 诞生环境</h2><h3 id="1-1-到底什么是闭包（Closure）？"><a href="#1-1-到底什么是闭包（Closure）？" class="headerlink" title="1.1 到底什么是闭包（Closure）？"></a>1.1 到底什么是闭包（Closure）？</h3><p>官方定义有点抽象：<strong>闭包是函数与其声明时所在词法环境的组合</strong>。</p>
<p>换成人话就是：一个函数在 “老家”（声明时的作用域）定义时，记下了周围的变量；后来就算跑到 “外地”（其他作用域）执行，也能找到这些 “老家的变量”—— 这就形成了闭包。</p>
<p>举个直观的例子，你看这个 “带记忆的函数”：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMemory</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// 这个变量是“老家的东西”，属于外部函数作用域</span></span><br><span class="line">  <span class="keyword">const</span> secret = <span class="string">'我是函数在老家时记住的内容'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 内部函数：相当于能找回“老家东西”的钥匙</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">getSecret</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(secret); <span class="comment">// 访问“老家”的变量</span></span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出这个“带记忆的函数”（此时外部函数已执行完，正常来说内部变量该消失了）</span></span><br><span class="line"><span class="keyword">const</span> myMemory = <span class="title function_">createMemory</span>();</span><br><span class="line"><span class="comment">// 调用函数：居然还能找到secret！</span></span><br><span class="line"><span class="title function_">myMemory</span>(); <span class="comment">// 输出："我是函数在老家时记住的内容"</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里的<code>getSecret</code>就是闭包 —— 它记得自己 “老家” 的环境，所以就算<code>createMemory</code>执行完了，也能找回<code>secret</code>。</p>
<h3 id="1-2-闭包形成的三个关键条件"><a href="#1-2-闭包形成的三个关键条件" class="headerlink" title="1.2 闭包形成的三个关键条件"></a>1.2 闭包形成的三个关键条件</h3><p>不是所有函数都是闭包，得满足这三个条件：</p>
<ol>
<li><strong>函数嵌套</strong>：内部函数定义在外部函数里面（比如<code>getSecret</code>在<code>createMemory</code>里）</li>
<li><strong>记着老家的变量</strong>：内部函数用到了外部函数的变量或参数（<code>getSecret</code>用了<code>secret</code>）</li>
<li><strong>离开老家</strong>：内部函数被返回、传递到外部函数作用域之外（<code>getSecret</code>被 return 出去，赋值给<code>myMemory</code>）</li>
</ol>
<div class="note info flat"><p><strong>这里有个容易误解的点：</strong> 闭包不是我们 “刻意创建” 的，而是<mark>函数定义时的自然结果</mark>！只要满足上面三个条件，闭包就会自动形成 —— 不用写特殊语法，它就在那了。</p></div>

<h3 id="1-3-闭包的核心特点"><a href="#1-3-闭包的核心特点" class="headerlink" title="1.3 闭包的核心特点"></a>1.3 闭包的核心特点</h3><ol>
<li><strong>变量持久化</strong>：相当于给变量 “延长了生命周期”。正常情况下，函数执行完，内部变量会被垃圾回收机制清理，但闭包能让变量一直 “活着”（比如上面的<code>secret</code>）</li>
<li><strong>变量私有权</strong>：外部无法直接碰闭包记住的变量。比如你没法直接改<code>secret</code>，只能通过<code>getSecret</code>这个 “接口” 访问 —— 这就实现了数据私有</li>
<li><strong>作用域链保留</strong>：闭包不只是记着自己用的变量，而是记着整个 “老家的环境链”（外部函数作用域 → 全局作用域）。比如如果<code>secret</code>还引用了全局变量，闭包也能找到</li>
</ol>
<h2 id="二、拆解闭包：看看它“记着”哪些东西"><a href="#二、拆解闭包：看看它“记着”哪些东西" class="headerlink" title="二、拆解闭包：看看它“记着”哪些东西"></a>二、拆解闭包：看看它 “记着” 哪些东西</h2><h3 id="2-1-经典案例：带闭包的计数器"><a href="#2-1-经典案例：带闭包的计数器" class="headerlink" title="2.1 经典案例：带闭包的计数器"></a>2.1 经典案例：带闭包的计数器</h3><p>用闭包实现计数器是最常见的场景，能清晰看到闭包如何 “保管” 变量：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// 被闭包“保管”的变量，外部拿不到</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回三个“操作接口”，都是闭包</span></span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">increment</span>: <span class="function">() =&gt;</span> count++, <span class="comment">// 加1</span></span><br><span class="line">    <span class="attr">decrement</span>: <span class="function">() =&gt;</span> count--, <span class="comment">// 减1</span></span><br><span class="line">    <span class="attr">getValue</span>: <span class="function">() =&gt;</span> count, <span class="comment">// 查当前值</span></span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个计数器</span></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getValue</span>()); <span class="comment">// 输出 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 试着直接访问count：拿不到！</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="property">count</span>); <span class="comment">// undefined！无法直接访问</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里的<code>increment</code>、<code>decrement</code>、<code>getValue</code>都是闭包，它们共享同一个<code>count</code>变量 —— 不管调用哪个方法，操作的都是同一个计数器，就像几个人共用一个笔记本一样。</p>
<h3 id="2-2-闭包的作用域链"><a href="#2-2-闭包的作用域链" class="headerlink" title="2.2 闭包的作用域链"></a>2.2 闭包的作用域链</h3><p>闭包能找到变量，靠的是作用域链。拿上面的计数器举例，作用域链是这样的：</p>
<div class="mermaid-wrap"><pre class="mermaid-src" hidden="">  graph LR
A["内部函数（increment）的环境"] --&gt; B["外部函数（createCounter）的环境"]
B --&gt; C[全局环境]
  </pre></div>

<p>当<code>increment</code>执行时，会先在自己的环境找<code>count</code>（没找到），再顺着作用域链往上找，直到在<code>createCounter</code>的环境里找到 —— 这就是闭包能访问外部变量的原理。</p>
<blockquote>
<p><strong>关键点</strong>：闭包会保留<strong>整个作用域链</strong>，而不仅仅是它用到的变量！</p>
</blockquote>
<h2 id="三、闭包的实战场景"><a href="#三、闭包的实战场景" class="headerlink" title="三、闭包的实战场景"></a>三、闭包的实战场景</h2><p>闭包不是理论概念，实际开发中到处都有它的影子，分享几个我常用的场景：</p>
<h3 id="3-1-数据封装：实现“私有变量”"><a href="#3-1-数据封装：实现“私有变量”" class="headerlink" title="3.1 数据封装：实现“私有变量”"></a>3.1 数据封装：实现 “私有变量”</h3><p>JavaScript 没有原生的 “私有变量” 语法，但用闭包就能模拟。比如实现一个银行账户，余额只能通过存款、取款接口操作，不能直接修改：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createBankAccount</span>(<span class="params">initialBalance</span>) {</span><br><span class="line">  <span class="keyword">let</span> balance = initialBalance; <span class="comment">// 私有变量，外部无法直接访问</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="comment">// 存款：只能通过这个方法加余额</span></span><br><span class="line">    <span class="attr">depositMoney</span>: <span class="function">(<span class="params">amount</span>) =&gt;</span> (balance += amount),</span><br><span class="line">    <span class="comment">// 取款：带校验逻辑，防止余额不足</span></span><br><span class="line">    <span class="attr">drawMoney</span>: <span class="function">(<span class="params">amount</span>) =&gt;</span> {</span><br><span class="line">      <span class="keyword">if</span> (amount &gt; balance) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">'余额不足'</span>);</span><br><span class="line">      <span class="keyword">return</span> (balance -= amount);</span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 查询余额：只能看，不能改</span></span><br><span class="line">    <span class="attr">getAmount</span>: <span class="function">() =&gt;</span> <span class="string">`余额：¥<span class="subst">${balance}</span>`</span>,</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建账户，初始1000元</span></span><br><span class="line"><span class="keyword">const</span> myAccount = <span class="title function_">createBankAccount</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 存500</span></span><br><span class="line">myAccount.<span class="title function_">depositMoney</span>(<span class="number">500</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myAccount.<span class="title function_">getAmount</span>()); <span class="comment">// 余额：¥1500</span></span><br><span class="line"><span class="comment">// 试着取2000：会报错，因为有校验</span></span><br><span class="line">myAccount.<span class="title function_">drawMoney</span>(<span class="number">2000</span>); <span class="comment">// Uncaught Error: 余额不足</span></span><br></pre></td></tr></tbody></table></figure>

<p>我在写组件状态管理时，经常用这种方式封装敏感数据，防止外部代码误改导致 bug。</p>
<h3 id="3-2-函数工厂：批量生成“定制化函数”"><a href="#3-2-函数工厂：批量生成“定制化函数”" class="headerlink" title="3.2 函数工厂：批量生成“定制化函数”"></a>3.2 函数工厂：批量生成 “定制化函数”</h3><p>如果需要多个逻辑相似但参数不同的函数，用闭包做 “函数工厂” 特别方便。比如生成不同风格的问候语：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createGreeting</span>(<span class="params">prefix</span>) {</span><br><span class="line">  <span class="comment">// prefix是“定制参数”，被闭包记住</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">name</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">${prefix}</span>，<span class="subst">${name}</span>！`</span>;</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成“正式问候”和“友好问候”两个函数</span></span><br><span class="line"><span class="keyword">const</span> formalGreeting = <span class="title function_">createGreeting</span>(<span class="string">'尊敬的'</span>);</span><br><span class="line"><span class="keyword">const</span> friendlyGreeting = <span class="title function_">createGreeting</span>(<span class="string">'嘿'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用的时候直接传名字就行，不用再重复写前缀</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">formalGreeting</span>(<span class="string">'王总'</span>)); <span class="comment">// "尊敬的，王总！"</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">friendlyGreeting</span>(<span class="string">'小明'</span>)); <span class="comment">// "嘿，小明！"</span></span><br></pre></td></tr></tbody></table></figure>

<p>我之前做表单验证时，用这个方法生成了一堆校验函数（比如 “最小长度校验”“最大长度校验”），不用重复写逻辑，代码简洁了很多。</p>
<h3 id="3-3-事件处理：保留“上下文信息”"><a href="#3-3-事件处理：保留“上下文信息”" class="headerlink" title="3.3 事件处理：保留“上下文信息”"></a>3.3 事件处理：保留 “上下文信息”</h3><p>写事件绑定的时候，经常需要在回调里用外部变量，这时候闭包就派上用场了。比如给多个按钮绑定点击事件，输出各自的索引：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buttons = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">'button'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; buttons.<span class="property">length</span>; i++) {</span><br><span class="line">  buttons[i].<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`按钮 <span class="subst">${i}</span> 被点击`</span>);</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这里的箭头函数就是闭包，它记住了循环时的<code>i</code>。不过，如果用<code>var</code>声明<code>i</code>（没有块级作用域），反而会出问题，得用 IIFE + 闭包兼容，不过现在有<code>let</code>就简单多了。</p>
<h3 id="3-4-模块模式：早期前端模块化的基础"><a href="#3-4-模块模式：早期前端模块化的基础" class="headerlink" title="3.4 模块模式：早期前端模块化的基础"></a>3.4 模块模式：早期前端模块化的基础</h3><p>在 ES6 Module 出现之前，前端模块化基本靠闭包实现。比如封装一个工具模块，只暴露需要的接口，内部逻辑隐藏起来：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myModule = (<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// 私有状态：外部看不到</span></span><br><span class="line">  <span class="keyword">let</span> state = <span class="string">'初始化'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 私有函数：只能在模块内部用</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">privateMethod</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'执行内部操作'</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 公开接口：外部只能通过这些方法访问内部</span></span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">action</span>: <span class="function">() =&gt;</span> {</span><br><span class="line">      <span class="title function_">privateMethod</span>();</span><br><span class="line">      state = <span class="string">'已更新'</span>;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">getState</span>: <span class="function">() =&gt;</span> state,</span><br><span class="line">  };</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用公开方法</span></span><br><span class="line">myModule.<span class="title function_">action</span>(); <span class="comment">// "执行内部操作"</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myModule.<span class="title function_">getState</span>()); <span class="comment">// "已更新"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 试着访问私有成员：拿不到</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myModule.<span class="property">state</span>); <span class="comment">// undefined</span></span><br><span class="line">myModule.<span class="title function_">privateMethod</span>(); <span class="comment">// Uncaught TypeError: myModule.privateMethod is not a function</span></span><br></pre></td></tr></tbody></table></figure>

<p>这种模式我在维护老项目时经常见到，虽然现在有 ES Module 了，但闭包的封装思想依然很有用。</p>
<h2 id="四、闭包的坑：内存浪费与优化"><a href="#四、闭包的坑：内存浪费与优化" class="headerlink" title="四、闭包的坑：内存浪费与优化"></a>四、闭包的坑：内存浪费与优化</h2><p>闭包虽好用，但用不好容易出问题，最常见的就是 “内存浪费”（内存泄漏）。</p>
<h3 id="4-1-为什么会内存浪费？"><a href="#4-1-为什么会内存浪费？" class="headerlink" title="4.1 为什么会内存浪费？"></a>4.1 为什么会内存浪费？</h3><p>闭包会 “留住” 它记住的环境里的变量，不让垃圾回收机制（GC）清理。如果闭包引用了大对象（比如 DOM 元素、超大数组），又一直没被销毁，这些对象就会一直占着内存，导致内存越用越多。</p>
<p>举个反面例子：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">heavyOperation</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// 模拟一个10MB的大数组</span></span><br><span class="line">  <span class="keyword">const</span> largeData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>).<span class="title function_">fill</span>(<span class="string">'占用内存的数据'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 闭包引用了largeData</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(largeData.<span class="property">length</span>);</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用后，largeData被闭包记住，无法被清理</span></span><br><span class="line"><span class="keyword">const</span> memoryHog = <span class="title function_">heavyOperation</span>();</span><br><span class="line"><span class="comment">// 就算后面不用memoryHog了，largeData也还在内存里</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果这种闭包多了，页面会越来越卡，甚至崩溃。</p>
<div class="note warning flat"><p><strong>内存泄漏警告：</strong> 闭包会阻止其作用域链上所有变量被回收，不当使用会导致<mark>内存泄漏</mark>！</p></div>

<h3 id="4-2-优化技巧：避免内存浪费"><a href="#4-2-优化技巧：避免内存浪费" class="headerlink" title="4.2 优化技巧：避免内存浪费"></a>4.2 优化技巧：避免内存浪费</h3><p>分享几个我实战中用过的优化方法：</p>
<ol>
<li><strong>主动 “忘记” 变量</strong>：不用闭包时，手动把它记住的变量设为<code>null</code>，让 GC 能清理</li>
</ol>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createClosure</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">let</span> data = <span class="string">'需要保留的数据'</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">closure</span> = (<span class="params"></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 给闭包加个“清理方法”</span></span><br><span class="line">  closure.<span class="property">cleanup</span> = <span class="function">() =&gt;</span> {</span><br><span class="line">    data = <span class="literal">null</span>; <span class="comment">// 解除引用，让闭包“忘记”data，GC能回收了</span></span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> closure;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myClosure = <span class="title function_">createClosure</span>();</span><br><span class="line"><span class="comment">// 使用完闭包后，调用清理方法</span></span><br><span class="line">myClosure.<span class="title function_">cleanup</span>();</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li><strong>只记需要的内容</strong>：如果只需要大对象的部分数据，就别引用整个对象</li>
</ol>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createClosure</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> largeData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>).<span class="title function_">fill</span>(<span class="string">'大数据'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 只记需要的小数据（比如长度），不引用整个largeData</span></span><br><span class="line">  <span class="keyword">const</span> metaData = { <span class="attr">length</span>: largeData.<span class="property">length</span> };</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(metaData.<span class="property">length</span>);</span><br><span class="line">  };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-3-闭包-vs-ES6-块级作用域"><a href="#4-3-闭包-vs-ES6-块级作用域" class="headerlink" title="4.3 闭包 vs ES6 块级作用域"></a>4.3 闭包 vs ES6 块级作用域</h3><p>有些场景下，ES6 的<code>let/const</code>（块级作用域）能替代闭包，代码更简洁。比如之前的循环绑定事件：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旧方法：用IIFE+闭包兼容var的问题</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">  (<span class="keyword">function</span> (<span class="params">j</span>) {</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(j), <span class="number">100</span>);</span><br><span class="line">  })(i);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新方法：用let的块级作用域，不用闭包</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(i), <span class="number">100</span>); <span class="comment">// 输出0,1,2,3,4</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>因为<code>let</code>在循环里每次迭代都会创建一个新的作用域，定时器回调能直接拿到当前的<code>i</code> —— 这时候就不用再写闭包了。</p>
<h2 id="五、底层原理：闭包为什么能“记住”环境？"><a href="#五、底层原理：闭包为什么能“记住”环境？" class="headerlink" title="五、底层原理：闭包为什么能“记住”环境？"></a>五、底层原理：闭包为什么能 “记住” 环境？</h2><p>其实闭包的底层就是 “作用域链” 的机制。再梳理下它的形成过程：</p>
<div class="mermaid-wrap"><pre class="mermaid-src" hidden="">  graph TD
A["外部函数被调用，创建执行环境"] --&gt; B["内部函数定义，记录当前的词法环境"]
B --&gt; C["内部函数引用外部函数的变量"]
C --&gt; D["外部函数执行完，返回内部函数到外部作用域"]
D --&gt; E["内部函数被调用时，通过作用域链找到外部变量，闭包生效"]
  </pre></div>

<p>简单说：函数定义时会 “记下自己在哪出生”（词法作用域），执行时会顺着这个 “出生地链条” 找变量 —— 闭包就是利用了这个机制，让函数在别的地方执行时，还能找到 “老家” 的环境。</p>
<h3 id="5-1-现代引擎的优化：不用怕闭包影响性能"><a href="#5-1-现代引擎的优化：不用怕闭包影响性能" class="headerlink" title="5.1 现代引擎的优化：不用怕闭包影响性能"></a>5.1 现代引擎的优化：不用怕闭包影响性能</h3><p>很多人担心闭包性能差，但现代 JavaScript 引擎（比如 V8，Chrome 和 Node.js 用的）对闭包做了很多优化：</p>
<ul>
<li><strong>按需保留</strong>：只保留闭包真正用到的变量，没用的变量会被 GC 清理（比如上面的<code>largeData</code>如果没被引用，就会被回收）</li>
<li><strong>缓存常用变量</strong>：频繁访问的闭包变量会被缓存，访问速度更快</li>
<li><strong>优化对象查找</strong>：对闭包引用的对象做特殊处理，减少属性查找时间</li>
</ul>
<p>所以不用过度担心闭包的性能问题 —— 正常使用下，性能开销可以忽略不计。只有在循环里频繁创建闭包（比如每秒创建上千个），才需要注意优化。</p>
<h2 id="六、闭包最佳实践：这些坑我踩过，你别踩"><a href="#六、闭包最佳实践：这些坑我踩过，你别踩" class="headerlink" title="六、闭包最佳实践：这些坑我踩过，你别踩"></a>六、闭包最佳实践：这些坑我踩过，你别踩</h2><p>分享几个我实战中总结的经验，帮你避开闭包的坑：</p>
<ol>
<li><p><strong>少记无关内容</strong>：只让闭包记住必要的变量，别把不需要的东西也带在身上。比如上面的银行账户，只暴露<code>depositMoney</code>等方法，不暴露<code>balance</code>。</p>
</li>
<li><p><strong>能不用就不用</strong>：如果用块级作用域（<code>let/const</code>）能解决问题，就别用闭包。比如循环里用<code>let</code>替代<code>var + 闭包</code>，代码更简洁，也少了内存开销。</p>
</li>
<li><p><strong>小心循环引用</strong>：闭包引用 DOM 元素时，容易形成 “闭包 →DOM→ 闭包” 的循环引用。解决方法是：事件不用时手动移除监听，或用<code>WeakMap</code>/<code>WeakSet</code>（弱引用）存储 DOM。</p>
</li>
<li><p><strong>明确生命周期</strong>：用闭包封装组件时，尽量做成 “自包含” 的模块，不用时调用清理方法，释放内存。</p>
</li>
</ol>
<h2 id="七、常见问题解答"><a href="#七、常见问题解答" class="headerlink" title="七、常见问题解答"></a>七、常见问题解答</h2><h3 id="Q1：闭包是什么？举个例子"><a href="#Q1：闭包是什么？举个例子" class="headerlink" title="Q1：闭包是什么？举个例子"></a>Q1：闭包是什么？举个例子</h3><p><strong>闭包是函数记住并访问其词法作用域的能力</strong>，哪怕函数在词法作用域之外执行。比如实现计数器：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> count++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line"><span class="title function_">counter</span>(); <span class="comment">// 0</span></span><br><span class="line"><span class="title function_">counter</span>(); <span class="comment">// 1</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Q2：闭包有什么优缺点？"><a href="#Q2：闭包有什么优缺点？" class="headerlink" title="Q2：闭包有什么优缺点？"></a>Q2：闭包有什么优缺点？</h3><p><strong>优点</strong>：</p>
<ul>
<li>实现数据封装（私有变量），防止外部误改</li>
<li>保留变量状态（比如计数器），不用依赖全局变量</li>
<li>批量生成定制化函数（函数工厂）</li>
<li>是早期前端模块化的基础</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>可能导致内存浪费（引用的变量无法清理）</li>
<li>频繁创建闭包有轻微性能开销</li>
<li>调试时不容易追踪变量来源（Chrome DevTools 里变量会标为<code>Closure</code>）</li>
</ul>
<h3 id="Q3：如何避免闭包导致的内存浪费？"><a href="#Q3：如何避免闭包导致的内存浪费？" class="headerlink" title="Q3：如何避免闭包导致的内存浪费？"></a>Q3：如何避免闭包导致的内存浪费？</h3><ul>
<li>只让闭包记住必要的变量，减少无关引用</li>
<li>不用闭包时，主动把引用的变量设为<code>null</code></li>
<li>避免在闭包里引用大对象（比如大数组、整个 DOM 树）</li>
<li>用<code>WeakMap</code>/<code>WeakSet</code>存储引用，让 GC 能清理</li>
<li>明确闭包的生命周期，不用时执行清理逻辑（比如移除事件监听）</li>
</ul>
<h2 id="八、闭包总结：不是难题，是实用工具"><a href="#八、闭包总结：不是难题，是实用工具" class="headerlink" title="八、闭包总结：不是难题，是实用工具"></a>八、闭包总结：不是难题，是实用工具</h2><p>最后用一张表总结闭包的核心特性，方便大家回顾：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>词法作用域</strong></td>
<td>闭包的基础，函数定义时决定 “老家”</td>
<td>所有闭包场景</td>
</tr>
<tr>
<td><strong>保留变量状态</strong></td>
<td>让变量不被清理，持续可用</td>
<td>计数器、缓存工具</td>
</tr>
<tr>
<td><strong>数据封装</strong></td>
<td>变量私有，只能通过闭包访问</td>
<td>模块开发、模拟类</td>
</tr>
<tr>
<td><strong>函数工厂</strong></td>
<td>动态生成带定制参数的函数</td>
<td>表单验证、问候语生成</td>
</tr>
<tr>
<td><strong>内存开销</strong></td>
<td>保留作用域链，可能占内存</td>
<td>需要优化的场景</td>
</tr>
<tr>
<td><strong>调试标识</strong></td>
<td>Chrome DevTools 中变量标为<code>Closure</code></td>
<td>调试闭包相关问题</td>
</tr>
</tbody></table>
<hr>
<p>很多人觉得闭包难，是因为它 “看不见摸不着”—— 但其实只要理解 “函数记住老家环境” 这个核心，再结合实际场景多练，很快就能掌握。</p>
<p>闭包不是需要害怕的难题，而是 JavaScript 里实用的工具。用好了它，你就能写出更安全、更优雅的代码，比如封装组件、管理状态、实现模块化 —— 现在就试着用闭包写个小工具吧！</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/site/avatar.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/site/avatar.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Touko</div><div class="post-copyright__author_desc">🐾猫爪按日出, 按出彩虹糖🌈</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://toukoxu.github.io/archives/closure/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://toukoxu.github.io/archives/closure/')">闭包（Closure）：JavaScript 里的 “记忆小助手”</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/wechat.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/wechat.webp" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/alipay.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/pay/alipay.webp" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://toukoxu.github.io/archives/closure/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://toukoxu.github.io" target="_blank">Touko</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E5%89%8D%E7%AB%AF/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>前端<span class="categoryesPageCount">10</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/JavaScript/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>JavaScript<span class="tagsPageCount">10</span></a><a class="post-meta__box__tags" href="/tags/ES6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>ES6<span class="tagsPageCount">6</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/scope-chain/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/scope-chain.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">作用域链（Scope Chain）：JS 变量查找的 “路线图”</div></div></a></div><div class="next-post pull-right"><a href="/archives/prototype-chain/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/prototype-chain.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">原型链（Prototype Chain）与 Class：吃透 JS 对象继承的核心</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/archives/generator/" title="生成器函数与 yield：掌控函数执行的 “暂停键”"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/generator.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-11</div><div class="title">生成器函数与 yield：掌控函数执行的 “暂停键”</div></div></a></div><div><a href="/archives/iterator/" title="迭代器（Iterator）与解构：JS 数据遍历与拆箱的实用指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/iterator.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-14</div><div class="title">迭代器（Iterator）与解构：JS 数据遍历与拆箱的实用指南</div></div></a></div><div><a href="/archives/prototype-chain/" title="原型链（Prototype Chain）与 Class：吃透 JS 对象继承的核心"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/prototype-chain.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-05-02</div><div class="title">原型链（Prototype Chain）与 Class：吃透 JS 对象继承的核心</div></div></a></div><div><a href="/archives/proxy/" title="代理（Proxy）：ES6 元编程的 “对象拦截器”"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/proxy.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-15</div><div class="title">代理（Proxy）：ES6 元编程的 “对象拦截器”</div></div></a></div><div><a href="/archives/reflect/" title="Reflect：ES6 标准化对象操作的 “工具库”"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/reflect.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-14</div><div class="title">Reflect：ES6 标准化对象操作的 “工具库”</div></div></a></div><div><a href="/archives/async+await/" title="Async &#x2F; Await：用同步的方式写异步，真香！"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/async.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-13</div><div class="title">Async &#x2F; Await：用同步的方式写异步，真香！</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/site/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/emoji/sparkles.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">欢迎来到我的<b style="color:#fff">编程小天地</b>！这里有可爱的<b style="color:#fff">编程知识点</b>，致力于把复杂的概念变得<b style="color:#fff">简单可爱</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">一起探索，让代码生活更精彩！</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about/"><h1 class="author-info__name">Touko</h1><div class="author-info__desc">🐾猫爪按日出, 按出彩虹糖🌈</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/ToukoXu" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">😊 欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%97%AD%E5%8C%85%E7%9A%84%E6%9C%AC%E8%B4%A8%EF%BC%9A%E5%87%BD%E6%95%B0-%E8%AF%9E%E7%94%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">一、闭包的本质：函数 + 诞生环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%98%AF%E9%97%AD%E5%8C%85%EF%BC%88Closure%EF%BC%89%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 到底什么是闭包（Closure）？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E9%97%AD%E5%8C%85%E5%BD%A2%E6%88%90%E7%9A%84%E4%B8%89%E4%B8%AA%E5%85%B3%E9%94%AE%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 闭包形成的三个关键条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E9%97%AD%E5%8C%85%E7%9A%84%E6%A0%B8%E5%BF%83%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 闭包的核心特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%8B%86%E8%A7%A3%E9%97%AD%E5%8C%85%EF%BC%9A%E7%9C%8B%E7%9C%8B%E5%AE%83%E2%80%9C%E8%AE%B0%E7%9D%80%E2%80%9D%E5%93%AA%E4%BA%9B%E4%B8%9C%E8%A5%BF"><span class="toc-number">3.</span> <span class="toc-text">二、拆解闭包：看看它 “记着” 哪些东西</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%BB%8F%E5%85%B8%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%B8%A6%E9%97%AD%E5%8C%85%E7%9A%84%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 经典案例：带闭包的计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 闭包的作用域链</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%97%AD%E5%8C%85%E7%9A%84%E5%AE%9E%E6%88%98%E5%9C%BA%E6%99%AF"><span class="toc-number">4.</span> <span class="toc-text">三、闭包的实战场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%EF%BC%9A%E5%AE%9E%E7%8E%B0%E2%80%9C%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E2%80%9D"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 数据封装：实现 “私有变量”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%87%BD%E6%95%B0%E5%B7%A5%E5%8E%82%EF%BC%9A%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90%E2%80%9C%E5%AE%9A%E5%88%B6%E5%8C%96%E5%87%BD%E6%95%B0%E2%80%9D"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 函数工厂：批量生成 “定制化函数”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%9A%E4%BF%9D%E7%95%99%E2%80%9C%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF%E2%80%9D"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 事件处理：保留 “上下文信息”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F%EF%BC%9A%E6%97%A9%E6%9C%9F%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E5%9F%BA%E7%A1%80"><span class="toc-number">4.4.</span> <span class="toc-text">3.4 模块模式：早期前端模块化的基础</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%97%AD%E5%8C%85%E7%9A%84%E5%9D%91%EF%BC%9A%E5%86%85%E5%AD%98%E6%B5%AA%E8%B4%B9%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">四、闭包的坑：内存浪费与优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%86%85%E5%AD%98%E6%B5%AA%E8%B4%B9%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 为什么会内存浪费？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7%EF%BC%9A%E9%81%BF%E5%85%8D%E5%86%85%E5%AD%98%E6%B5%AA%E8%B4%B9"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 优化技巧：避免内存浪费</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%97%AD%E5%8C%85-vs-ES6-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">5.3.</span> <span class="toc-text">4.3 闭包 vs ES6 块级作用域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%EF%BC%9A%E9%97%AD%E5%8C%85%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E2%80%9C%E8%AE%B0%E4%BD%8F%E2%80%9D%E7%8E%AF%E5%A2%83%EF%BC%9F"><span class="toc-number">6.</span> <span class="toc-text">五、底层原理：闭包为什么能 “记住” 环境？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E7%8E%B0%E4%BB%A3%E5%BC%95%E6%93%8E%E7%9A%84%E4%BC%98%E5%8C%96%EF%BC%9A%E4%B8%8D%E7%94%A8%E6%80%95%E9%97%AD%E5%8C%85%E5%BD%B1%E5%93%8D%E6%80%A7%E8%83%BD"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 现代引擎的优化：不用怕闭包影响性能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%97%AD%E5%8C%85%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%9A%E8%BF%99%E4%BA%9B%E5%9D%91%E6%88%91%E8%B8%A9%E8%BF%87%EF%BC%8C%E4%BD%A0%E5%88%AB%E8%B8%A9"><span class="toc-number">7.</span> <span class="toc-text">六、闭包最佳实践：这些坑我踩过，你别踩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94"><span class="toc-number">8.</span> <span class="toc-text">七、常见问题解答</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Q1%EF%BC%9A%E9%97%AD%E5%8C%85%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E4%B8%BE%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="toc-number">8.1.</span> <span class="toc-text">Q1：闭包是什么？举个例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Q2%EF%BC%9A%E9%97%AD%E5%8C%85%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%BC%BA%E7%82%B9%EF%BC%9F"><span class="toc-number">8.2.</span> <span class="toc-text">Q2：闭包有什么优缺点？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Q3%EF%BC%9A%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E9%97%AD%E5%8C%85%E5%AF%BC%E8%87%B4%E7%9A%84%E5%86%85%E5%AD%98%E6%B5%AA%E8%B4%B9%EF%BC%9F"><span class="toc-number">8.3.</span> <span class="toc-text">Q3：如何避免闭包导致的内存浪费？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E9%97%AD%E5%8C%85%E6%80%BB%E7%BB%93%EF%BC%9A%E4%B8%8D%E6%98%AF%E9%9A%BE%E9%A2%98%EF%BC%8C%E6%98%AF%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">9.</span> <span class="toc-text">八、闭包总结：不是难题，是实用工具</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/proxy/" title="代理（Proxy）：ES6 元编程的 “对象拦截器”"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/proxy.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代理（Proxy）：ES6 元编程的 “对象拦截器”"/></a><div class="content"><a class="title" href="/archives/proxy/" title="代理（Proxy）：ES6 元编程的 “对象拦截器”">代理（Proxy）：ES6 元编程的 “对象拦截器”</a><time datetime="2024-08-15T12:46:25.000Z" title="发表于 2024-08-15 20:46:25">2024-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/reflect/" title="Reflect：ES6 标准化对象操作的 “工具库”"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/reflect.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Reflect：ES6 标准化对象操作的 “工具库”"/></a><div class="content"><a class="title" href="/archives/reflect/" title="Reflect：ES6 标准化对象操作的 “工具库”">Reflect：ES6 标准化对象操作的 “工具库”</a><time datetime="2024-08-14T12:46:25.000Z" title="发表于 2024-08-14 20:46:25">2024-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/async+await/" title="Async / Await：用同步的方式写异步，真香！"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/async.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Async / Await：用同步的方式写异步，真香！"/></a><div class="content"><a class="title" href="/archives/async+await/" title="Async / Await：用同步的方式写异步，真香！">Async / Await：用同步的方式写异步，真香！</a><time datetime="2024-07-13T12:46:25.000Z" title="发表于 2024-07-13 20:46:25">2024-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/generator/" title="生成器函数与 yield：掌控函数执行的 “暂停键”"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/generator.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="生成器函数与 yield：掌控函数执行的 “暂停键”"/></a><div class="content"><a class="title" href="/archives/generator/" title="生成器函数与 yield：掌控函数执行的 “暂停键”">生成器函数与 yield：掌控函数执行的 “暂停键”</a><time datetime="2024-07-11T12:46:25.000Z" title="发表于 2024-07-11 20:46:25">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/message-channel/" title="MessageChannel 详解：浏览器中的 “点对点双向通信管道”"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/cover/message-channel.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MessageChannel 详解：浏览器中的 “点对点双向通信管道”"/></a><div class="content"><a class="title" href="/archives/message-channel/" title="MessageChannel 详解：浏览器中的 “点对点双向通信管道”">MessageChannel 详解：浏览器中的 “点对点双向通信管道”</a><time datetime="2024-06-23T12:46:25.000Z" title="发表于 2024-06-23 20:46:25">2024-06-23</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:toukoxu@qq.com" title="给我发邮件" target="_blank"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" href="/atom.xml" title="RSS" target="_blank"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/site/avatar.webp" size="50px"/><a class="deal_link" href="https://github.com/toukoxu" title="Github" target="_blank"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="/copyright" title="CC" target="_blank"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Touko-%E5%8D%96%E5%8A%9B%E4%B8%8A%E7%8F%AD%E4%B8%AD-white?style=social&amp;logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiPjxwYXRoIGZpbGw9IiNmZmMxMDciIGQ9Im0xNC41IDcuOTk1YzAtLjQxNC0uMzM2LS43NS0uNzUtLjc1LTMuMDMyIDAtNS41LTIuNDY4LTUuNS01LjUgMC0uNDE0LS4zMzYtLjc1LS43NS0uNzVzLS43NS4zMzYtLjc1Ljc1YzAgMy4wMzItMi40NjggNS41LTUuNSA1LjUtLjQxNCAwLS43NS4zMzYtLjc1Ljc1cy4zMzYuNzUuNzUuNzVjMy4wMzIgMCA1LjUgMi40NjggNS41IDUuNSAwIC40MTQuMzM2Ljc1Ljc1Ljc1cy43NS0uMzM2Ljc1LS43NWMwLTMuMDMyIDIuNDY4LTUuNSA1LjUtNS41LjQxNCAwIC43NS0uMzM2Ljc1LS43NXoiLz48cGF0aCBmaWxsPSIjZmZjMTA3IiBkPSJtMjEuNSAxNi4yNDVjLTIuNDgxIDAtNC41LTIuMDE5LTQuNS00LjUgMC0uNDE0LS4zMzYtLjc1LS43NS0uNzVzLS43NS4zMzYtLjc1Ljc1YzAgMi40ODEtMi4wMTkgNC41LTQuNSA0LjUtLjQxNCAwLS43NS4zMzYtLjc1Ljc1cy4zMzYuNzUuNzUuNzVjMi40ODEgMCA0LjUgMi4wMTkgNC41IDQuNSAwIC40MTQuMzM2Ljc1Ljc1Ljc1cy43NS0uMzM2Ljc1LS43NWMwLTIuNDgxIDIuMDE5LTQuNSA0LjUtNC41LjQxNCAwIC43NS0uMzM2Ljc1LS43NXMtLjMzNi0uNzUtLjc1LS43NXoiLz48ZyBmaWxsPSIjZmZjYTI4Ij48cGF0aCBkPSJtMjMuMjUgNC4yNDVjLTEuOTMgMC0zLjUtMS41Ny0zLjUtMy41IDAtLjQxNC0uMzM2LS43NS0uNzUtLjc1cy0uNzUuMzM2LS43NS43NWMwIDEuOTMtMS41NyAzLjUtMy41IDMuNS0uNDE0IDAtLjc1LjMzNi0uNzUuNzVzLjMzNi43NS43NS43NWMxLjkzIDAgMy41IDEuNTcgMy41IDMuNSAwIC40MTQuMzM2Ljc1Ljc1Ljc1cy43NS0uMzM2Ljc1LS43NWMwLTEuOTMgMS41Ny0zLjUgMy41LTMuNS40MTQgMCAuNzUtLjMzNi43NS0uNzVzLS4zMzYtLjc1LS43NS0uNzV6Ii8+PHBhdGggZD0ibTguNzUgMTkuMjQ1Yy0xLjM3OSAwLTIuNS0xLjEyMS0yLjUtMi41IDAtLjQxNC0uMzM2LS43NS0uNzUtLjc1cy0uNzUuMzM2LS43NS43NWMwIDEuMzc5LTEuMTIxIDIuNS0yLjUgMi41LS40MTQgMC0uNzUuMzM2LS43NS43NXMuMzM2Ljc1Ljc1Ljc1YzEuMzc5IDAgMi41IDEuMTIxIDIuNSAyLjUgMCAuNDE0LjMzNi43NS43NS43NXMuNzUtLjMzNi43NS0uNzVjMC0xLjM3OSAxLjEyMS0yLjUgMi41LTIuNS40MTQgMCAuNzUtLjMzNi43NS0uNzVzLS4zMzYtLjc1LS43NS0uNzV6Ii8+PC9nPjwvc3ZnPg==" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用jsDelivr为静态资源提供CDN加速" title="本站使用jsDelivr为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-E84D3D.svg?logo=jsdelivr" alt="本站使用jsDelivr为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Source-GitHub-181717.svg?logo=github" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="Touko" target="_blank">Touko</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["晨光温柔&#44; 晚风清甜&#44; 岁岁无忧&#44; 步步生暖."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">1</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://toukoxu.github.io/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">图片工具</div><div class="back-menu-list"><a class="back-menu-item" href="/projects/image-base64" title="图片转Base64"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/picture.gif" alt="图片转Base64"/><span class="back-menu-item-text">图片转Base64</span></a><a class="back-menu-item" href="/projects/image-webp" title="图片转WebP"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/picture.gif" alt="图片转WebP"/><span class="back-menu-item-text">图片转WebP</span></a><a class="back-menu-item" href="/projects/image-compress" title="图片压缩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/picture.gif" alt="图片压缩"/><span class="back-menu-item-text">图片压缩</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">文本工具</div><div class="back-menu-list"><a class="back-menu-item" href="/projects/text-diff" title="文本差异对比"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/text.gif" alt="文本差异对比"/><span class="back-menu-item-text">文本差异对比</span></a><a class="back-menu-item" href="/projects/image-base64" title="CSS/JS压缩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/text.gif" alt="CSS/JS压缩"/><span class="back-menu-item-text">CSS/JS压缩</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">金融工具</div><div class="back-menu-list"><a class="back-menu-item" href="/projects/finance-calculator" title="金融计算器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/toukoxu/picstore@main/images/gif/star.gif" alt="金融计算器"/><span class="back-menu-item-text">金融计算器</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ES2017-ES8/" style="font-size: 0.88rem;">ES2017(ES8)<sup>1</sup></a><a href="/tags/ES6/" style="font-size: 0.88rem;">ES6<sup>6</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">JavaScript<sup>10</sup></a><a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 0.88rem;">性能优化<sup>6</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/JavaScript" title="JavaScript">JavaScript</a><a class="tag-list" href="/tags/Vue" title="Vue">Vue</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.2/dist/svg-pan-zoom.min.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [`叮！可爱加载中... `, `🐱`];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `%c ${ascll[0]} %c${ascll[1]}`,
      "color:white; background-color:#f0ad4e",
      ''
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "你正在访问 Touko 的博客.",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2021 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://img.shields.io/badge/Touko-%E4%B8%8B%E7%8F%AD%E5%95%A6~-white?style=social&amp;logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiPjxwYXRoIGZpbGw9IiNmZmMxMDciIGQ9Im0xNC41IDcuOTk1YzAtLjQxNC0uMzM2LS43NS0uNzUtLjc1LTMuMDMyIDAtNS41LTIuNDY4LTUuNS01LjUgMC0uNDE0LS4zMzYtLjc1LS43NS0uNzVzLS43NS4zMzYtLjc1Ljc1YzAgMy4wMzItMi40NjggNS41LTUuNSA1LjUtLjQxNCAwLS43NS4zMzYtLjc1Ljc1cy4zMzYuNzUuNzUuNzVjMy4wMzIgMCA1LjUgMi40NjggNS41IDUuNSAwIC40MTQuMzM2Ljc1Ljc1Ljc1cy43NS0uMzM2Ljc1LS43NWMwLTMuMDMyIDIuNDY4LTUuNSA1LjUtNS41LjQxNCAwIC43NS0uMzM2Ljc1LS43NXoiLz48cGF0aCBmaWxsPSIjZmZjMTA3IiBkPSJtMjEuNSAxNi4yNDVjLTIuNDgxIDAtNC41LTIuMDE5LTQuNS00LjUgMC0uNDE0LS4zMzYtLjc1LS43NS0uNzVzLS43NS4zMzYtLjc1Ljc1YzAgMi40ODEtMi4wMTkgNC41LTQuNSA0LjUtLjQxNCAwLS43NS4zMzYtLjc1Ljc1cy4zMzYuNzUuNzUuNzVjMi40ODEgMCA0LjUgMi4wMTkgNC41IDQuNSAwIC40MTQuMzM2Ljc1Ljc1Ljc1cy43NS0uMzM2Ljc1LS43NWMwLTIuNDgxIDIuMDE5LTQuNSA0LjUtNC41LjQxNCAwIC43NS0uMzM2Ljc1LS43NXMtLjMzNi0uNzUtLjc1LS43NXoiLz48ZyBmaWxsPSIjZmZjYTI4Ij48cGF0aCBkPSJtMjMuMjUgNC4yNDVjLTEuOTMgMC0zLjUtMS41Ny0zLjUtMy41IDAtLjQxNC0uMzM2LS43NS0uNzUtLjc1cy0uNzUuMzM2LS43NS43NWMwIDEuOTMtMS41NyAzLjUtMy41IDMuNS0uNDE0IDAtLjc1LjMzNi0uNzUuNzVzLjMzNi43NS43NS43NWMxLjkzIDAgMy41IDEuNTcgMy41IDMuNSAwIC40MTQuMzM2Ljc1Ljc1Ljc1cy43NS0uMzM2Ljc1LS43NWMwLTEuOTMgMS41Ny0zLjUgMy41LTMuNS40MTQgMCAuNzUtLjMzNi43NS0uNzVzLS4zMzYtLjc1LS43NS0uNzV6Ii8+PHBhdGggZD0ibTguNzUgMTkuMjQ1Yy0xLjM3OSAwLTIuNS0xLjEyMS0yLjUtMi41IDAtLjQxNC0uMzM2LS43NS0uNzUtLjc1cy0uNzUuMzM2LS43NS43NWMwIDEuMzc5LTEuMTIxIDIuNS0yLjUgMi41LS40MTQgMC0uNzUuMzM2LS43NS43NXMuMzM2Ljc1Ljc1Ljc1YzEuMzc5IDAgMi41IDEuMTIxIDIuNSAyLjUgMCAuNDE0LjMzNi43NS43NS43NXMuNzUtLjMzNi43NS0uNzVjMC0xLjM3OSAxLjEyMS0yLjUgMi41LTIuNS40MTQgMCAuNzUtLjMzNi43NS0uNzVzLS4zMzYtLjc1LS43NS0uNzV6Ii8+PC9nPjwvc3ZnPg==";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc?.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
          const svgElement = document.getElementById(mermaidID)
          const viewBox = svgElement.getAttribute('viewBox')
          const viewBoxValues = viewBox.split(/[\s,]+/)
          window.svgPanZoom ? svgPanZoom(svgElement, { contain: true, controlIconsEnabled: true }) : ''
          const width = Number(getComputedStyle(svgElement).getPropertyValue('width').slice(0, -2))
          svgElement.setAttribute('height', `${viewBoxValues[3] * width / viewBoxValues[2]}px`)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'BsIRp7GQE8IZ5fkI0JRj8Vys-gzGzoHsz',
      appKey: 'vla82YKrFnfwtuQfgoaDnzu9',
      avatar: 'mp',
      serverURLs: 'https://bsirp7gq.lc-cn-n1-shared.com',
      emojiMaps: {"3d眼镜":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/3d眼镜.png","EDG":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/EDG.png","LPL":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/LPL.png","beluga":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/beluga.png","不好意思":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/不好意思.png","不服吗":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/不服吗.png","亲亲":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/亲亲.png","伞兵":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/伞兵.png","倚墙笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/倚墙笑.png","值得肯定":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/值得肯定.png","偷偷看":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/偷偷看.png","傻笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/傻笑.png","再见":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/再见.png","出家人":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/出家人.png","击剑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/击剑.png","加班":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/加班.png","勉强笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/勉强笑.png","危险":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/危险.png","发红包":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/发红包.png","吃手":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/吃手.png","吃瓜":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/吃瓜.png","吐血":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/吐血.png","吵架":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/吵架.png","呦吼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/呦吼.png","呲牙笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/呲牙笑.png","哈士奇":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/哈士奇.png","哈士奇失去意识":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/哈士奇失去意识.png","哈士奇失望":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/哈士奇失望.png","哭泣":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/哭泣.png","唱歌":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/唱歌.png","喜欢":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/喜欢.png","嘿哈":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/嘿哈.png","大笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/大笑.png","失去信号":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/失去信号.png","失望":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/失望.png","头秃":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/头秃.png","奋斗":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/奋斗.png","好奇":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/好奇.png","好的":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/好的.png","害羞":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/害羞.png","小丑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/小丑.png","小偷":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/小偷.png","尬笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/尬笑.png","尴尬":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/尴尬.png","应援":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/应援.png","开心":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/开心.png","引起不适":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/引起不适.png","微笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/微笑.png","思考":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/思考.png","恶心":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/恶心.png","恶魔":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/恶魔.png","恶魔恐惧":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/恶魔恐惧.png","惊吓":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/惊吓.png","惊吓白眼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/惊吓白眼.png","惊讶":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/惊讶.png","惬意":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/惬意.png","感动":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/感动.png","愤怒":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/愤怒.png","我看好你":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/我看好你.png","手机相机":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/手机相机.png","打咩":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/打咩.png","打牌":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/打牌.png","托腮":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/托腮.png","扶额":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/扶额.png","抠鼻":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/抠鼻.png","抬眼镜":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/抬眼镜.png","拜托":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/拜托.png","捂嘴笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/捂嘴笑.png","捂脸":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/捂脸.png","擦汗":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/擦汗.png","放鞭炮":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/放鞭炮.png","敬礼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/敬礼.png","整理发型":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/整理发型.png","斗鸡眼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/斗鸡眼.png","智慧的眼神":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/智慧的眼神.png","月饼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/月饼.png","有没有搞错":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/有没有搞错.png","正确":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/正确.png","没招":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/没招.png","波吉":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/波吉.png","泪奔":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/泪奔.png","流汗微笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/流汗微笑.png","流鼻涕":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/流鼻涕.png","深思":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/深思.png","滑稽":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽.png","滑稽吃瓜":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽吃瓜.png","滑稽喝水":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽喝水.png","滑稽奶茶":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽奶茶.png","滑稽柠檬":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽柠檬.png","滑稽狂汗":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽狂汗.png","滑稽被子":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/滑稽被子.png","烦恼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/烦恼.png","熊熊":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熊熊.png","熊猫":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熊猫.png","熊猫唱歌":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熊猫唱歌.png","熊猫喜欢":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熊猫喜欢.png","熊猫失望":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熊猫失望.png","熊猫意外":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熊猫意外.png","熬夜":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/熬夜.png","爆炸":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/爆炸.png","牛年进宝":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/牛年进宝.png","狂热":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狂热.png","狗头":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头.png","狗头围脖":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头围脖.png","狗头失望":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头失望.png","狗头意外":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头意外.png","狗头胖次":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头胖次.png","狗头花":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头花.png","狗头草":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/狗头草.png","猪头":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/猪头.png","猪头意外":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/猪头意外.png","生病":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/生病.png","电话":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/电话.png","疑问":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/疑问.png","疼痛":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/疼痛.png","痛哭":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/痛哭.png","看穿一切":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/看穿一切.png","眩晕":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/眩晕.png","睡觉":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/睡觉.png","禁言":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/禁言.png","笑哭":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/笑哭.png","纠结":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/纠结.png","绿帽":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/绿帽.png","缺牙笑":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/缺牙笑.png","翻白眼":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/翻白眼.png","老虎意外":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/老虎意外.png","耍酷":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/耍酷.png","胡子":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/胡子.png","菜狗":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/菜狗.png","菜狗花":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/菜狗花.png","蒙面滑稽":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/蒙面滑稽.png","虎年进宝":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/虎年进宝.png","被打":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/被打.png","裂开":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/裂开.png","警告":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/警告.png","读书":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/读书.png","财神红包":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/财神红包.png","超爱":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/超爱.png","这是啥":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/这是啥.png","送福":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/送福.png","送花":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/送花.png","错误":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/错误.png","阴险":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/阴险.png","难以置信":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/难以置信.png","面具":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/面具.png","饥渴":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/饥渴.png","鬼脸":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/鬼脸.png","黑线":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/黑线.png","鼓掌":"https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/鼓掌.png"},
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://bsirp7gq.lc-cn-n1-shared.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'BsIRp7GQE8IZ5fkI0JRj8Vys-gzGzoHsz',
        "X-LC-Key": 'vla82YKrFnfwtuQfgoaDnzu9',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@touko.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>